{% extends "base.html" %}

{% block title %}Request Product - Smart QR Shopping{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Request a Product</h1>
        <p>Can't find what you're looking for? Let the store know!</p>
    </div>

    <div class="card">
        <form onsubmit="handleProductRequest(event)">
            <div class="form-group">
                <label>Product Name</label>
                <input type="text" id="request-product-name" required placeholder="What product would you like?">
            </div>
            <div class="form-group">
                <label>Additional Details (Optional)</label>
                <textarea id="request-details" rows="3"
                    placeholder="Any specific requirements or details..."></textarea>
            </div>
            <button type="submit" class="btn-primary">Submit Request</button>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const storeId = "{{ store_id }}";

    async function handleProductRequest(event) {
        event.preventDefault();

        const productName = document.getElementById('request-product-name').value;

        try {
            const response = await fetch('/api/requests', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    store_id: storeId,
                    product_name: productName
                })
            });

            if (response.ok) {
                alert('Product request submitted successfully!');
                window.history.back();
            } else {
                alert('Failed to submit request');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred');
        }
    }
</script>
{% endblock %}